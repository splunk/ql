<!-- Reporting -->
<form version="1.1" script="access_enable_disable.js">
  <search>
    <query>
      | rest /services/authorization/roles splunk_server=local f=imported_roles f=title | fields title imported_roles | rename imported_roles AS imported | fillnull value=NIL imported
| mvexpand imported | appendpipe [where imported!="NIL" | eval all_imported=imported,imported=title,title=null()] | eventstats values(all_imported) as all_imported by imported | stats values(imported*) as imported* by title | eval imported=mvdedup(mvappend(imported,all_imported)) | fields title | search title="*admin" OR title="*splunk_app_soar" OR title="*splunk_app_soar_dashboards"
    </query>
    <done>
      <condition match="$job.resultCount$&gt;0">
        <set token="access">true</set>
        <set token="displayContent">true</set>
        <unset token="displayError">false</unset>
      </condition>
      <condition match="$job.resultCount$==0">
        <set token="access">false</set>
        <unset token="displayContent">false</unset>
        <set token="displayError">true</set>
      </condition>
    </done>
  </search>
  <search>
    <query>
      | rest /services/server/info/server-info | eval type=if(isnotnull(instance_type), instance_type, "enterprise") | search type=cloud
    </query>
     <done>
      <condition match="$job.resultCount$>0">
        <set token="cloud">true</set>
        <unset token="enterprise">false</unset>
      </condition>
      <condition match="$job.resultCount$==0">
        <set token="enterprise">true</set>
        <unset token="cloud">false</unset>
      </condition>
    </done>
  </search>
  <label>Containers &amp; Notes Search</label>
  <search id="base_index_prefix" depends="$displayContent$">
    <query>(index=*phantom_container OR index=*phantom_note) AND sourcetype=phantom_search | fields * </query>
    <earliest>$field1.earliest$</earliest>
    <latest>$field1.latest$</latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <fieldset submitButton="false" autoRun="false">
    <input type="time" token="field1" searchWhenChanged="true">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="index_prefix" searchWhenChanged="true">
      <label>Index Prefix</label>
      <choice value="*phantom_">All</choice>
      <default>All</default>
      <fieldForLabel>index_prefix_label</fieldForLabel>
      <fieldForValue>index_prefix</fieldForValue>
      <search base="base_index_prefix">
        <query>| rex field=index "(?&lt;index_prefix&gt;[\S]*_*phantom_)(container|note)$" | eval index_prefix_label=index_prefix."*" | stats count by index_prefix_label, index_prefix</query>
      </search>
    </input>
    <input type="text" token="text">
      <label>Search</label>
      <default>*</default>
    </input>
    <input type="multiselect" token="container_type" searchWhenChanged="true">
      <label>Container Type</label>
      <choice value="case">Case</choice>
      <choice value="default">Event</choice>
      <default>case,default</default>
      <delimiter> OR </delimiter>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>container_type="</valuePrefix>
      <valueSuffix>"</valueSuffix>
    </input>
    <input type="multiselect" token="sensitivity" searchWhenChanged="true">
      <label>Sensitivity</label>
      <choice value="white">White</choice>
      <choice value="green">Green</choice>
      <choice value="amber">Amber</choice>
      <choice value="red">Red</choice>
      <default>white,green,amber,red</default>
      <delimiter>  OR </delimiter>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>sensitivity="</valuePrefix>
      <valueSuffix>"</valueSuffix>
    </input>
    <input type="multiselect" token="severity" searchWhenChanged="true">
      <label>Severity</label>
      <choice value="*">All</choice>
      <fieldForLabel>severity</fieldForLabel>
      <fieldForValue>severity</fieldForValue>
      <search base="base_index_prefix">
        <query>| search index=$index_prefix$container | spath severity | dedup severity | sort severity | table severity</query>
      </search>
      <valuePrefix>severity="</valuePrefix>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
      <default>*</default>
    </input>
    <input type="multiselect" token="label" searchWhenChanged="true">
      <label>Label</label>
      <choice value="*">All</choice>
      <fieldForLabel>container_label</fieldForLabel>
      <fieldForValue>container_label</fieldForValue>
      <search base="base_index_prefix">
        <query>| search index=$index_prefix$container $severity$ $sensitivity$ | stats count by container_label | sort - count</query>
      </search>
      <valuePrefix>container_label="</valuePrefix>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
      <default>*</default>
    </input>
    <input type="multiselect" token="status" searchWhenChanged="true">
      <label>Status</label>
      <choice value="*">All</choice>
      <fieldForLabel>status_label</fieldForLabel>
      <fieldForValue>status</fieldForValue>
      <search base="base_index_prefix">
        <query>| search index=$index_prefix$container $severity$ $sensitivity$ | eval status_label = upper(substr(status,1,1)).substr(status,2) | stats count by status_label, status | sort - count</query>
      </search>
      <valuePrefix>status="</valuePrefix>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
      <default>All</default>
    </input>
  </fieldset>
  <row depends="$displayError$,$cloud$">
    <panel>
    <html>
      <div>
        ERROR: At least one of the following roles is required to view this page: splunk_app_soar, splunk_app_soar_dashboards, or sc_admin. Contact your Splunk administrator for access.
      </div>
    </html>
    </panel>
  </row>
  <row depends="$displayError$,$enterprise$">
    <panel>
    <html>
      <div>
        ERROR: At least one of the following roles is required to view this page: splunk_app_soar, splunk_app_soar_dashboards, or admin. Contact your Splunk administrator for access.
      </div>
    </html>
    </panel>
  </row>
  <row depends="$displayContent$">
    <panel>
      <title>Case Search Match</title>
      <table>
        <search base="base_index_prefix" id="case_match">
          <query>
            search index=$index_prefix$container | spath container_type | search $container_type$ $text$ $severity$ $sensitivity$ $status$ $label$ | dedup index id | table container_update_time index id name description status owner_name container_label severity sensitivity | eval description_preview=substr(description,1,50)
            | fields - description
            | sort - container_update_time
            | rename container_update_time as "Last Updated" index as "Index" id as "ContainerID" name as "Container Name" description_preview as "Description Preview" status as "Status" owner_name as "Owner" container_label as "Label" sensitivity as "Sensitivity" severity as "Severity"
          </query>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <link target="_blank">search?q=index%3D$row.Index$%20id%3D$row.ContainerID$&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row depends="$displayContent$">
    <panel>
      <title>Notes Search Match</title>
      <table>
        <search base="base_index_prefix" id="note_match">
          <query>
          search index=$index_prefix$note | spath container_type | search $container_type$ $label$ | rex field=index "(?&lt;index_prefix&gt;[\S]*_*phantom)_note" | join type=outer index_prefix container
            [ search index=$index_prefix$container $container_type$ $severity$ $sensitivity$ $status$ $label$
            | dedup index id 
            | rex field=index "(?&lt;index_prefix&gt;[\S]*_*phantom)_container"
            | rename id as container
            | fields index_prefix container status severity sensitivity]
            | search $text$ $severity$ $sensitivity$ $status$
            | eval content_preview=substr(content,1,50)
            | table modified_time index container id container_type title status container_label severity sensitivity content_preview note_type
            | sort - modified_time
            | rename modified_time as "Last Updated" index as "Index" container as "ContainerID" id as "NoteID" container_type as "Container Type" title as "Title" content_preview as "Content Preview" note_type as "Note Type" container_label as "Label" status as "Status" sensitivity as "Sensitivity" severity as "Severity"
        </query>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <link target="_blank">search?q=index%3D$row.Index$%20id%3D$row.NoteID$&amp;earliest=$field1.earliest$&amp;latest=$field1.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>