<!-- Reporting -->
<form version="1.1" script="access_enable_disable.js">
  <search>
    <query>
      | rest /services/authorization/roles splunk_server=local f=imported_roles f=title | fields title imported_roles | rename imported_roles AS imported | fillnull value=NIL imported
| mvexpand imported | appendpipe [where imported!="NIL" | eval all_imported=imported,imported=title,title=null()] | eventstats values(all_imported) as all_imported by imported | stats values(imported*) as imported* by title | eval imported=mvdedup(mvappend(imported,all_imported)) | fields title | search title="*admin" OR title="*splunk_app_soar" OR title="*splunk_app_soar_dashboards"
    </query>
    <done>
      <condition match="$job.resultCount$&gt;0">
        <set token="access">true</set>
        <set token="displayContent">true</set>
        <unset token="displayError">false</unset>
      </condition>
      <condition match="$job.resultCount$==0">
        <set token="access">false</set>
        <unset token="displayContent">false</unset>
        <set token="displayError">true</set>
      </condition>
    </done>
  </search>
  <search>
    <query>
      | rest /services/server/info/server-info | eval type=if(isnotnull(instance_type), instance_type, "enterprise") | search type=cloud
    </query>
     <done>
      <condition match="$job.resultCount$>0">
        <set token="cloud">true</set>
        <unset token="enterprise">false</unset>
      </condition>
      <condition match="$job.resultCount$==0">
        <set token="enterprise">true</set>
        <unset token="cloud">false</unset>
      </condition>
    </done>
  </search>
  <label>SOAR Container Overview</label>
  <fieldset submitButton="false">
    <input type="time" token="field1">
      <label></label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
    <input type="dropdown" token="index_prefix" searchWhenChanged="true">
      <label>Index Prefix</label>
      <choice value="*phantom_">All</choice>
      <default>All</default>
      <fieldForLabel>index_prefix_label</fieldForLabel>
      <fieldForValue>index_prefix</fieldForValue>
      <search depends="$displayContent$" base="base_index_prefix">
        <query>| eval index_prefix_label=index_prefix."*" | stats count by index_prefix_label, index_prefix | sort -count</query>
      </search>
    </input>
    <input type="dropdown" token="owner_name" searchWhenChanged="true">
      <label>Analyst</label>
      <choice value="*">All</choice>
      <default>*</default>
      <fieldForLabel>owner_name</fieldForLabel>
      <fieldForValue>owner_name</fieldForValue>
      <search depends="$displayContent$" base="base_fieldset">
        <query>| stats  count by owner_name | sort -count</query>
      </search>
    </input>
    <input type="multiselect" token="container_type">
      <label>Container Type</label>
      <choice value="case">Case</choice>
      <choice value="default">Event</choice>
      <default>case,default</default>
      <delimiter>  OR </delimiter>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>container_type="</valuePrefix>
      <valueSuffix>"</valueSuffix>
    </input>
    <input type="multiselect" token="sensitivity">
      <label>Sensitivity</label>
      <choice value="white">White</choice>
      <choice value="green">Green</choice>
      <choice value="amber">Amber</choice>
      <choice value="red">Red</choice>
      <default>white,green,amber,red</default>
      <delimiter>  OR </delimiter>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>sensitivity="</valuePrefix>
      <valueSuffix>"</valueSuffix>
    </input>
    <input type="multiselect" token="severity" searchWhenChanged="true">
      <label>Severity</label>
      <choice value="*">All</choice>
      <fieldForLabel>severity</fieldForLabel>
      <fieldForValue>severity</fieldForValue>
      <search base="base_index_prefix">
        <query>| search index=$index_prefix$container | spath severity | dedup severity | sort severity | table severity</query>
      </search>
      <valuePrefix>severity="</valuePrefix>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
      <default>*</default>
    </input>
    <input type="multiselect" token="label" searchWhenChanged="true">
      <label>Label</label>
      <choice value="*">All</choice>
      <fieldForLabel>container_label</fieldForLabel>
      <fieldForValue>container_label</fieldForValue>
      <search depends="$displayContent$" base="base_fieldset">
        <query>| search owner_name=$owner_name$ $severity$ $sensitivity$ | stats count by container_label | sort - count</query>
      </search>
      <valuePrefix>container_label="</valuePrefix>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
      <default>*</default>
    </input>
    <input type="multiselect" token="status" searchWhenChanged="true">
      <label>Status</label>
      <choice value="*">All</choice>
      <fieldForLabel>status_label</fieldForLabel>
      <fieldForValue>status</fieldForValue>
      <search depends="$displayContent$" base="base_fieldset">
        <query>| search owner_name=$owner_name$ $severity$ $sensitivity$ | eval status_label = upper(substr(status,1,1)).substr(status,2) | stats count by status_label, status | sort - count</query>
      </search>
      <valuePrefix>status="</valuePrefix>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
      <default>All</default>
    </input>
  </fieldset>
  <search id="base_index_prefix" depends="$displayContent$">
    <query>index=*phantom_container sourcetype=phantom_search | rex field=index "(?&lt;index_prefix&gt;[\S]*_*phantom_)(container)$" | fields * </query>
    <earliest>$field1.earliest$</earliest>
    <latest>$field1.latest$</latest>
    <refresh>60s</refresh>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="base_fieldset" base="base_index_prefix" depends="$displayContent$">
    <query>| search index=$index_prefix$container | table index, id, close_time, start_time, container_update_time, avg_duration, status, end_utc, start_utc, container_type, owner_name, owner, role, container_label, severity, sensitivity | eval owner_name=if((owner == "null" and role == "null"), "Unassigned", owner_name) | eval owner_name=if((owner == "null" and role != "null"), owner_name, owner_name) | eval most_recent_update=if((container_update_time == "null"), start_time, container_update_time) | sort -most_recent_update | dedup index id | fields - owner</query>
  </search>
  <search id="base_label_all" base="base_fieldset" depends="$displayContent$">
    <query>| search $container_type$ container_label=* owner_name=$owner_name$ $status$ $severity$ $sensitivity$ | table index, id, close_time, start_time, avg_duration, status, end_utc, start_utc, container_type, owner_name, container_label</query>
  </search>
  <search id="base_label_defined" base="base_fieldset" depends="$displayContent$">
    <query>| search $container_type$ $label$ owner_name="$owner_name$" $status$ $severity$ $sensitivity$ | table index, id, close_time, start_time, avg_duration, status, end_utc, start_utc, container_type, owner_name, container_label</query>
  </search>
  <search id="base_label_defined_duration" base="base_label_defined" depends="$displayContent$">
    <query>| eval tnow = now() | strcat start_time "+0000" start_utc | strcat close_time "+0000" end_utc | eval end = if (close_time="null", tnow,strptime(end_utc,"%Y-%m-%dT%H:%M:%S.%6QZ%z") ) |  eval start = strptime(start_utc,"%Y-%m-%dT%H:%M:%S.%6QZ%z") | eval duration= end -start </query>
  </search>
  <search id="base_label_all_duration" base="base_label_all" depends="$displayContent$">
    <query>| eval tnow = now() | strcat start_time "+0000" start_utc | strcat close_time "+0000" end_utc | eval end = if (close_time="null", tnow,strptime(end_utc,"%Y-%m-%dT%H:%M:%S.%6QZ%z") ) |  eval start = strptime(start_utc,"%Y-%m-%dT%H:%M:%S.%6QZ%z") | eval duration= end -start </query>
  </search>
  <row depends="$displayError$,$cloud$">
    <panel>
      <html>
      <div>
        ERROR: At least one of the following roles is required to view this page: splunk_app_soar, splunk_app_soar_dashboards, or sc_admin. Contact your Splunk administrator for access.
      </div>
    </html>
    </panel>
  </row>
  <row depends="$displayError$,$enterprise$">
    <panel>
      <html>
      <div>
        ERROR: At least one of the following roles is required to view this page: splunk_app_soar, splunk_app_soar_dashboards, or admin. Contact your Splunk administrator for access.
      </div>
    </html>
    </panel>
  </row>
  <row depends="$displayContent$">
    <panel>
      <title>New Containers</title>
      <single>
        <search base="base_label_defined">
          <query>| eval new=mvfilter(match(status,"new")) | stats count(new)</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[5,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Open Containers</title>
      <single>
        <search base="base_label_defined">
          <query>| eval open=mvfilter(match(status,"open")) | stats count(open)</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[5,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Resolved Containers</title>
      <single>
        <search base="base_label_defined">
          <query>| eval closed=mvfilter(match(status,"closed")) | stats count(closed)</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x0877A6","0x0877A6"]</option>
        <option name="rangeValues">[0]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Average Container Duration</title>
      <single>
        <search base="base_label_defined_duration">
          <query>| stats avg(duration) as avg_duration | eval field_in_hhmmss=tostring(avg_duration, "duration") | rex field=field_in_hhmmss "(?&lt;duration&gt;[^\.]+)(\.[0-9])*" | fields - field_in_hhmmss | fields - avg_duration</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="rangeValues">[0,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="underLabel">DD+HH:MM:SS</option>
        <option name="useColors">1</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
    <panel>
      <title>Average Resolution Time</title>
      <single>
        <search base="base_label_all">
          <query>| eval end = strptime(close_time,"%Y-%m-%dT%H:%M:%S") | eval start = strptime(start_time,"%Y-%m-%dT%H:%M:%S") | eval duration= end -start | stats avg(duration) as avg_duration | eval field_in_hhmmss=tostring(avg_duration, "duration") | rex field=field_in_hhmmss "(?&lt;duration&gt;[^\.]+)(\.[0-9])*" | fields - field_in_hhmmss | fields - avg_duration</query>
        </search>
        <option name="colorBy">value</option>
        <option name="colorMode">none</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="rangeValues">[0,30,70,100]</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="underLabel">DD+HH:MM:SS</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
      </single>
    </panel>
  </row>
  <row depends="$displayContent$">
    <panel>
      <title>Containers by Status</title>
      <chart>
        <search base="base_label_defined">
          <query>| stats count by status</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">pie</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </chart>
    </panel>
    <panel>
      <title>Highest Container Duration Time by Analyst</title>
      <chart>
        <search base="base_label_defined_duration">
          <query>| eval duration = round(duration/3600, 2) | eval username=if((owner_name == "Unassigned"), null, owner_name) | sort - duration, + username | head 10 | eval username_index = owner_name." (".index.")"  | chart list(duration) by id, username_index  | rename owner_name as "Analyst" index as "Index" duration as "Duration in Hours" id as "Container ID" | fields - avg_duration_sec</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisTitleY.text">Duration in Hours</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="height">300</option>
      </chart>
    </panel>
    <panel>
      <title>Analyst Performance</title>
      <table>
        <search base="base_label_defined_duration">
          <query>
            | stats count as "Total Container Assigned" avg(duration) as avg_duration_sec by index owner_name   |   sort - avg_duration | head  10 |  eval duration = round(avg_duration_sec/3600, 2)
            | rename owner_name as "Analyst" | fields - avg_duration_sec | rename duration as "Duration in Hours" index as "Index"
          </query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <option name="showPager">true</option>
      </table>
    </panel>
  </row>
  <row depends="$displayContent$">
    <panel>
      <title>Longest Container Duration - Table</title>
      <table>
        <search base="base_label_defined_duration">
          <query>
            | stats avg(duration) as avg_duration by index id owner_name status container_type  | eval duration = round(avg_duration/3600, 2) | sort - duration  |  head 10 | eval container_type=if(container_type="default",  "event", container_type)
            | rename id as "Container ID" owner_name as "Container Owner" duration as "Duration in Hours" container_type as "Container Type" status as "Status" index as "Index"|  fields - avg_duration</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="percentagesRow">false</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <option name="showPager">true</option>
      </table>
    </panel>
    <panel>
      <title>Longest Container Duration</title>
      <chart>
        <search base="base_label_all_duration">
          <query>| stats avg(duration) as avg_duration_sec by index id | eval duration = round(avg_duration_sec/3600, 2) | sort - duration | head 10  | chart list(duration) by id, index | rename duration as "Duration in Hours" id as "Container ID" | fields - avg_duration_sec</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">0</option>
        <option name="charting.axisTitleX.visibility">visible</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">visible</option>
        <option name="charting.axisTitleY.text">Duration in Hours</option>
        <option name="charting.axisX.abbreviation">none</option>
        <option name="charting.axisX.scale">linear</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.axisY.scale">linear</option>
        <option name="charting.axisY2.abbreviation">none</option>
        <option name="charting.axisY2.enabled">0</option>
        <option name="charting.axisY2.scale">inherit</option>
        <option name="charting.chart">bar</option>
        <option name="charting.chart.bubbleMaximumSize">50</option>
        <option name="charting.chart.bubbleMinimumSize">10</option>
        <option name="charting.chart.bubbleSizeBy">area</option>
        <option name="charting.chart.nullValueMode">gaps</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.sliceCollapsingThreshold">0.01</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart.style">shiny</option>
        <option name="charting.drilldown">none</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.layout.splitSeries.allowIndependentYRanges">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.legend.mode">standard</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.lineWidth">2</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="height">300</option>
      </chart>
    </panel>
  </row>
</form>
